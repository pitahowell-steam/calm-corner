<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kawaii Calm Sanctuary</title>
    <style>
        :root { --soft-pink: #FFB7B2; --soft-blue: #B2CEFE; --night-blue: #0A192F; --text-dark: #444; --glass: rgba(255, 255, 255, 0.96); }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html { margin: 0; padding: 0; height: 100%; font-family: -apple-system, sans-serif; overflow: hidden; background: #FDFCF0; color: var(--text-dark); }
        
        .bg-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; background-size: cover; background-position: center; transition: all 1.2s ease; }
        .star { position: absolute; background: white; border-radius: 50%; opacity: 0.8; animation: twinkle 2s infinite alternate; z-index: 2; }
        @keyframes twinkle { from { opacity: 0.2; } to { opacity: 1; } }
        
        .screen { display: none; height: 100vh; width: 100vw; flex-direction: column; align-items: center; justify-content: center; position: absolute; z-index: 10; padding: 20px; background: transparent; }
        .active { display: flex; }
        
        .glass-card { background: var(--glass); padding: 30px; border-radius: 35px; width: 100%; max-width: 420px; text-align: center; box-shadow: 0 15px 35px rgba(0,0,0,0.07); border: 1px solid rgba(255,255,255,0.3); }
        .scene-card { background: white; width: 100%; padding: 18px; border-radius: 20px; margin-bottom: 12px; border: 3px solid #F0F0F0; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; font-weight: bold; }
        
        .pill-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; margin: 15px 0; }
        .pill { background: #F5F5F5; padding: 10px 18px; border-radius: 20px; font-weight: 600; color: #777; cursor: pointer; border: 2px solid transparent; }
        
        input, textarea { width: 100%; padding: 15px; border: 2px solid #EEE; border-radius: 18px; font-size: 16px; margin: 10px 0; outline: none; background: #FAFAFA; font-family: inherit; }
        .main-btn { color: white; padding: 16px 45px; border-radius: 35px; border: none; font-size: 18px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; }

        #breath-screen { background: rgba(0, 0, 0, 0.15) !important; backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); z-index: 100; }
        #breath-text { color: white; font-size: 34px; font-weight: bold; text-shadow: 0 4px 10px rgba(0,0,0,0.3); text-align: center; margin-bottom: 40px; }
        
        #breath-container { position: relative; flex: 1; display: flex; align-items: center; justify-content: center; width: 100%; }
        
        #target-circle { position: absolute; width: 100px; height: 100px; border-radius: 50%; border: 3px solid white; background: rgba(255, 255, 255, 0.05); transform: scale(2.6); z-index: 50; transition: border-color 0.5s; opacity: 0.4; }
        
        #breath-circle { width: 100px; height: 100px; border-radius: 50%; z-index: 60; transform: scale(1); will-change: transform; box-shadow: 0 0 20px rgba(255,255,255,0.4); animation: glow-pulse 2s infinite ease-in-out; }

        @keyframes glow-pulse { 0%, 100% { box-shadow: 0 0 10px rgba(255,255,255,0.2); } 50% { box-shadow: 0 0 40px rgba(255,255,255,0.6); } }

        .journal-list { width: 100%; max-width: 450px; overflow-y: auto; flex: 1; padding: 10px; }
        .journal-card { background: white; padding: 20px; border-radius: 25px; margin-bottom: 15px; display: flex; gap: 15px; align-items: center; box-shadow: 0 4px 10px rgba(0,0,0,0.03); border: 1px solid #EEE; text-align: left;}
        .mood-tag { font-size: 11px; font-weight: bold; color: #888; text-transform: uppercase; }
        .reflection-box { 
            background: #f8f9fa; /* Very light gray */
            padding: 12px; 
            border-radius: 12px; 
            font-size: 13px; 
            margin-top: 10px; 
            color: #444; 
            border: 1px solid #e0e0e0; 
            font-style: italic;
            width: 100%;           /* Fill the card */
            box-sizing: border-box; /* IMPORTANT: Keeps padding inside the width */
            display: block;        /* Ensures it stays on its own line */
            clear: both;           /* Prevents floating elements from pushing it */
        }
    .bubble {
        width: 85px;
        height: 85px;
        background: rgba(255, 255, 255, 0.25); 
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 38px;
        cursor: pointer;
        position: relative;
        border: 1px solid rgba(255, 255, 255, 0.4);
        box-shadow: inset 0 20px 30px rgba(255,255,255,0.3), 
                    inset 10px 10px 20px rgba(255,255,255,0.1),
                    0 10px 20px rgba(0,0,0,0.05);
    }
 /* The Glossy Highlight - Elongated & Realistic */
.bubble::before {
    content: '';
    position: absolute;
    top: 12%;      /* Distance from the top */
    left: 18%;     /* Distance from the left */
    width: 35%;    /* ELONGATE: Increase width for a long reflection */
    height: 15%;   /* ELONGATE: Decrease height for a slim reflection */
    background: rgba(255, 255, 255, 0.7);
    
    /* Rotate it slightly to follow the curve of the bubble */
    transform: rotate(-25deg); 
    
    border-radius: 50%; /* Keeps the ends rounded and soft */
    filter: blur(1.5px); /* Makes it look like light, not a hard sticker */
    z-index: 2;
    
    /* CUSTOMIZE NOTE: 
       To make the reflection longer: increase width (e.g., 45%)
       To make it thinner: decrease height (e.g., 10%)
       To change the angle: adjust rotate (e.g., -10deg or -45deg)
    */
}

   /* WHEN POPPED: Remove the background, the border, AND the highlight (::before) */
    .bubble.popped {
        background: transparent !important;
        border-color: transparent !important;
        backdrop-filter: none !important;
        -webkit-backdrop-filter: none !important;
        box-shadow: none !important;
    }
    .bubble.popped::before {
        display: none; /* This makes the highlight vanish instantly */
    }
    /* The Emoji Jump */
    .bubble.popped span {
        animation: kawaiiJump 0.6s ease-out forwards;
        display: inline-block;
        z-index: 10;
    }

  @keyframes kawaiiJump {
    0% { transform: translateY(0); }
    30% { transform: translateY(-25px) scale(1.1); }
    100% { transform: translateY(0) scale(1); }
}
    @keyframes burst {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.4); opacity: 0.5; border-width: 1px; }
    100% { transform: scale(1.6); opacity: 0; visibility: hidden; }
}

/* Make sure the emoji doesn't look muted */
.bubble span {
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
    opacity: 1 !important;
}
/* The Burst Ring */
.bubble.popped::after {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    border-radius: 50%;
    border: 2px solid white;
    animation: burstShell 0.3s ease-out forwards;
}
 @keyframes burstShell {
    0% { transform: scale(1); opacity: 1; }
    100% { transform: scale(1.8); opacity: 0; }
}
        
/* Darker but serene background for the Toolbox Screen */
div#toolbox-screen.screen.active {
    background-color: #D1D9E6 !important; /* Deeper, serene slate blue */
    background-image: radial-gradient(circle at top, #D1D9E6, #B8C6D9);
}
    </style>
</head>
<body>

    <div id="bg-layer" class="bg-layer"></div>

    <div id="login-screen" class="screen active">
        <div class="glass-card">
            <h1>‚ú® Kawaii Calm</h1>
            <p style="color: #888;">Welcome to your safe space.</p>
            <input type="text" id="name-input" placeholder="Enter Name..." autocomplete="off">
            <button class="main-btn" id="login-trigger" style="background: var(--soft-blue);">Enter Sanctuary</button>
        </div>
    </div>

    <div id="home-screen" class="screen">
        <div class="glass-card">
            <h2 style="margin:0;">Hi, <span id="user-display"></span>!</h2>
            <p style="font-weight: bold; color: #888;">üèÜ Points: <span id="points-display">0</span></p>
            <div class="scene-card" style="border-color: var(--soft-pink);" onclick="setTheme('garden')">üå∏ Garden</div>
            <div class="scene-card" style="border-color: var(--soft-blue);" onclick="setTheme('beach')">üèñÔ∏è Beach</div>
            <div class="scene-card" style="border-color: #4A90E2;" onclick="setTheme('night')">üåå Night</div>
            <button style="margin-top:15px; background:none; border:none; color: #4A90E2; font-weight:bold; cursor:pointer;" onclick="showJournal()">üìñ View Journey</button>
            <button style="margin-top:15px; background:none; border:none; color: #4CAF50; font-weight:bold; cursor:pointer;" onclick="showToolbox()">üß∞ Open Toolbox</button>
            <br>
            <button style="margin-top:10px; background:none; border:none; color:#CCC; cursor:pointer; font-size:12px;" onclick="location.reload()">Switch User</button>
        </div>
    </div>

    <div id="before-screen" class="screen">
        <div class="glass-card">
            <h2>How do you feel?</h2>
            <div id="before-pills" class="pill-container"></div>
            <input type="text" id="before-custom" placeholder="Or describe it here...">
            <button id="start-btn" class="main-btn" onclick="startBreath()">Start Breathing</button>
        </div>
    </div>

    <div id="breath-screen" class="screen">
        <h1 id="breath-text">Ready?</h1>
        <div id="breath-container">
            <div id="target-circle"></div>
            <div id="breath-circle"></div>
        </div>
    </div>

    <div id="after-screen" class="screen">
        <div class="glass-card">
            <h2>Feeling better?</h2>
            <div id="after-pills" class="pill-container"></div>
            <input type="text" id="after-custom" placeholder="I feel...">
            <button id="finish-btn" class="main-btn" onclick="handleLogic()">Complete Session</button>
        </div>
    </div>

    <div id="reward-screen" class="screen">
        <div class="glass-card" id="reward-content"></div>
    </div>
    <div id="toolbox-screen" class="screen" style="background: #F0F4F8;">
        <h2 style="margin-bottom: 5px;">My Wellness Toolbox</h2>
        <div id="active-tool-text" style="height: 60px; padding: 10px; font-weight: bold; color: #555; text-align: center; font-size: 14px;">
            Tap a bubble to see how it helps your body!
        </div>
        <div id="bubbles-container" class="pill-container" style="padding: 20px; flex: 1; align-content: flex-start;">
            </div>
        <button class="main-btn" style="background: #444; width: 200px; margin-bottom: 20px;" onclick="showScreen('home-screen')">Back Home</button>
    </div>
    <div id="journal-screen" class="screen" style="background: #F9FAFB;">
        <h2 style="margin-bottom: 5px;">Journal</h2>
        <div id="journal-list" class="journal-list"></div>
        <button class="main-btn" style="background: #444; width: 200px; margin: 20px;" onclick="showScreen('home-screen')">Back Home</button>
    </div>

    <script>
        const SUGGESTED_BEFORE = ["Overwhelmed", "Frustrated", "Tense", "Stressed", "Sad"];
        const SUGGESTED_AFTER = ["Steady", "Relaxed", "Better", "Focused", "Stronger"];
        const MISSIONS = [
            { task: "Find 3 blue things in the room.", q: "What did you see?" },
            { task: "Press your feet into the floor.", q: "How does it feel? (Hard, soft?)" },
            { task: "Look for something shaped like a circle.", q: "What object did you find?" }
        ];
        const REWARDS = [
            { emoji: "üê¢", name: "Patience Turtle", msg: "Slow and steady is a superpower." },
            { emoji: "üê±", name: "Lucky Cat", msg: "A friend for your peaceful moments." },
            { emoji: "‚òÄÔ∏è", name: "Golden Sun", msg: "Your energy lights up the room." },
            { emoji: "‚òÅÔ∏è", name: "Happy Cloud", msg: "Bad feelings pass just like clouds." },
            { emoji: "ü´Å", name: "Deep Breath", msg: "This sends a 'safe' signal to your Vagus nerve, telling your heart to slow down." },
            { emoji: "üçµ", name: "Herbal Tea", msg: "Holding a warm cup can ground you, while herbs like chamomile calm the brain." },
            { emoji: "üë£", name: "Barefoot Walk", msg: "Feeling the ground helps 'discharge' extra energy and reminds your body where it is." },
            { emoji: "üõãÔ∏è", name: "Weighted Blanket", msg: "Deep pressure release helps your body produce serotonin, the 'happy' chemical." },
            { emoji: "ü•£", name: "Sound Bowls", msg: "Steady vibrations help your brain waves move into a relaxed, 'alpha' state." },
            { emoji: "üé®", name: "Art & Color", msg: "Focusing on colors moves your brain from 'survival mode' to 'creative mode'." },
            { emoji: "üêù", name: "The Hum", msg: "Humming or 'Voo-ing' vibrates your chest, which physically turns off the 'fight or flight' switch." },
            { emoji: "üßò", name: "Yoga Pose", msg: "Stretching releases stored tension in your muscles and calms the nervous system." },
            { emoji: "‚òØÔ∏è", name: "Tai Chi", msg: "Slow, flowing movements help synchronize your breath and your heart rate." },
            { emoji: "üå≥", name: "Play Outside", msg: "Natural sunlight and fresh air reset your internal clock and lower cortisol." },
            { emoji: "üö∂", name: "Nature Walk", msg: "The rhythm of walking left-to-right helps both sides of your brain work together." },
            { emoji: "üíß", name: "Cold Water", msg: "Splashing cold water on your face triggers the 'Mammalian Dive Reflex' to instantly slow your heart." },
            { emoji: "ü¶ã", name: "Butterfly Hug", msg: "Tapping your shoulders rhythmically helps your brain process big, 'stuck' emotions." }
        ];
        const AFFIRMATIONS = [
            "I am proud of you for choosing to slow down and breathe.",
            "You are learning exactly what your body needs to feel safe.",
            "It takes strength to ground yourself when things feel heavy.",
            "You deserve to feel protected and held in this moment.",
            "I see you working hard to find your inner quiet.",
            "You have the power to change how you feel, one breath at a time.",
            "You are becoming so brave at listening to your body.",
            "You are safe, you are capable, and you are doing a great job.",
            "Giving yourself this time is a beautiful act of kindness.",
            "Your peace is worth the effort you are putting in right now."
        ];

        let currentUser = "";
        let inventory = [];
        let totalSessions = 0;
        let selectedTheme = { color: '#B2CEFE' };

        const loginBtn = document.getElementById('login-trigger');
        const nameInput = document.getElementById('name-input');

        function performLogin() {
            const name = nameInput.value.trim().toLowerCase();
            if(!name) return;
            currentUser = name;
            const saved = localStorage.getItem('@kawaii_' + currentUser);
            const data = saved ? JSON.parse(saved) : { inventory: [], total: 0 };
            inventory = data.inventory || [];
            totalSessions = data.total || 0;
            document.getElementById('user-display').innerText = currentUser;
            document.getElementById('points-display').innerText = totalSessions;
            showScreen('home-screen');
        }

        loginBtn.onclick = performLogin;
        nameInput.onkeypress = (e) => { if(e.key === 'Enter') performLogin(); };

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function setTheme(theme) {
            const bg = document.getElementById('bg-layer');
            bg.innerHTML = '';
            if(theme === 'garden') {
                selectedTheme.color = '#FFB7B2';
                bg.style.background = "url('https://images.unsplash.com/photo-1528459801416-a9e53bbf4e17?q=80&w=500') center/cover";
            } else if(theme === 'beach') {
                selectedTheme.color = '#B2CEFE';
                bg.style.background = "url('https://images.unsplash.com/photo-1507525428034-b723cf961d3e?q=80&w=500') center/cover";
            } else {
                selectedTheme.color = '#4A90E2';
                bg.style.background = "#0A192F";
                for(let i=0; i<35; i++) {
                    let s = document.createElement('div'); s.className = 'star';
                    s.style.width = s.style.height = Math.random()*3+'px';
                    s.style.top = Math.random()*100+'%'; s.style.left = Math.random()*100+'%';
                    bg.appendChild(s);
                }
            }
            setupPills();
            showScreen('before-screen');
        }

        function setupPills() {
            document.getElementById('before-pills').innerHTML = SUGGESTED_BEFORE.map(m => `<div class="pill" onclick="selPill(this, 'before')">${m}</div>`).join('');
            document.getElementById('after-pills').innerHTML = SUGGESTED_AFTER.map(m => `<div class="pill" onclick="selPill(this, 'after')">${m}</div>`).join('');
            document.getElementById('start-btn').style.background = selectedTheme.color;
            document.getElementById('finish-btn').style.background = selectedTheme.color;
        }

        function selPill(el, type) {
            el.parentElement.querySelectorAll('.pill').forEach(p => { p.style.background = '#F5F5F5'; p.style.borderColor = 'transparent'; });
            el.style.background = 'white'; el.style.borderColor = selectedTheme.color;
            document.getElementById(type + '-custom').value = el.innerText;
        }

       function startBreath() {
        showScreen('breath-screen');
        const circle = document.getElementById('breath-circle');
        const target = document.getElementById('target-circle');
        const txt = document.getElementById('breath-text');
        
        // 1. THE RESET: Force the circle to be small instantly
        circle.style.transition = "none"; 
        circle.style.transform = "scale(0.4)"; 
        
        // Apply theme colors
        circle.style.backgroundColor = selectedTheme.color;
        target.style.borderColor = selectedTheme.color;
        target.style.opacity = "0.4";
    
        const patterns = [
            {t: "In...", s: 2.6, d: 4000}, 
            {t: "Hold", s: 2.6, d: 2000}, 
            {t: "Out...", s: 0.4, d: 6000}, 
            {t: "Rest", s: 0.4, d: 2000}
        ];
        let step = 0;
        let cycle = 1;
    
        function next() {
            if (step >= patterns.length) {
                if (cycle < 3) { 
                    cycle++; 
                    step = 0; 
                } else { 
                    showScreen('after-screen'); 
                    return; 
                }
            }

        txt.innerHTML = `${patterns[step].t}<br><small style="font-size:14px; opacity:0.6">Round ${cycle}/3</small>`;
        
        // 2. THE ANIMATION: Re-enable transitions and move to next size
        circle.style.transition = `transform ${patterns[step].d}ms ease-in-out`;
        circle.style.transform = `scale(${patterns[step].s})`;

        setTimeout(() => { 
            step++; 
            next(); 
        }, patterns[step].d);
    }

    // 3. THE KICKSTART: This 100ms delay prevents the "Starting Large" bug
    setTimeout(next, 100);
}
        function handleLogic() {
            const beforeMood = document.getElementById('before-custom').value || "Okay";
            const afterMood = document.getElementById('after-custom').value || "Better";
            const content = document.getElementById('reward-content');
            const isMission = Math.random() > 0.5;
            totalSessions++;

            if(isMission) {
                const m = MISSIONS[Math.floor(Math.random()*MISSIONS.length)];
                content.innerHTML = `
                    <p style="color:#4CAF50; font-weight:bold;">üßò GROUNDING MISSION</p>
                    <h2>${m.task}</h2><p>${m.q}</p>
                    <textarea id="mission-refl" placeholder="Type what you found..."></textarea>
                    <button class="main-btn" style="background:#4CAF50" onclick="saveMission('${m.task}', '${beforeMood}', '${afterMood}')">Save Mission</button>
                `;
               } else {
        // 1. Pick a random reward and a random affirmation independently
        const r = REWARDS[Math.floor(Math.random() * REWARDS.length)];
        const randomAffirmation = AFFIRMATIONS[Math.floor(Math.random() * AFFIRMATIONS.length)];
    
        // 2. Save to inventory (storing both the tool info and the specific affirmation they got)
        inventory.unshift({ 
            emoji: r.emoji, 
            name: r.name, 
            msg: r.msg, 
            affirmation: randomAffirmation, // Tied together just for this entry
            before: beforeMood, 
            after: afterMood, 
            date: new Date().toLocaleDateString() 
        });
    
        // 3. Display them on the reward screen
        content.innerHTML = `
            <div style="font-size:80px; margin-bottom:15px;">${r.emoji}</div>
            <h2 style="color:#2D3748; margin-bottom:10px;">${r.name}</h2>
            
            <div style="background: rgba(255,255,255,0.5); padding: 15px; border-radius: 20px; margin-bottom: 15px; border: 1px dashed ${selectedTheme.color};">
                <p style="font-style:italic; color:#2C3E50; font-size:17px; margin:0; font-weight:600;">
                    "${randomAffirmation}"
                </p> 
            </div>
    
            <p style="font-size:13px; color:#666; line-height:1.4;">
                <strong>Tool Tip:</strong> ${r.msg}
            </p>
    
            <button class="main-btn" style="background:${selectedTheme.color}" onclick="showScreen('home-screen')">Collect Reward</button>
        `;
    }
            saveData();
            showScreen('reward-screen');
        }

        function saveMission(task, before, after) {
            const refl = document.getElementById('mission-refl').value || "No response recorded.";
            inventory.unshift({ 
                emoji: 'üèÖ', 
                name: 'Mission Medal', 
                msg: task,          // This is the mission question
                reflection: refl,   // This is the student's typed answer
                before: before, 
                after: after, 
                date: new Date().toLocaleDateString() 
            });
            saveData();
            showScreen('home-screen');
        }
        function saveData() {
            localStorage.setItem('@kawaii_' + currentUser, JSON.stringify({inventory, total: totalSessions}));
            const d = document.getElementById('points-display');
            if(d) d.innerText = totalSessions;
        }

        function showJournal() {
    const list = document.getElementById('journal-list');
    
    list.innerHTML = inventory.length === 0 ? "<p>No entries yet!</p>" : inventory.map(i => {
        const entryText = i.msg || i.reflection || "No details recorded";
        const entryTitle = i.name || (i.emoji === 'üèÖ' ? "Mission Medal" : "Entry");

        return `
            <div class="journal-card" style="display: flex; gap: 15px; align-items: flex-start;">
                <div style="font-size:35px; min-width: 45px; text-align: center;">${i.emoji}</div>
                
                <div style="flex: 1; min-width: 0;"> 
                    <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                        <span class="mood-tag">${i.date}</span>
                        <span style="font-size:11px; color:${selectedTheme.color}; font-weight:bold;">
                            ${i.before || '...'} ‚ûî ${i.after || '...'}
                        </span>
                    </div>
                    <div style="font-weight:bold; font-size: 15px;">${entryTitle}</div>
                    <div style="font-size: 13px; color:#666; line-height: 1.4;">${entryText}</div>
                   
<div style="font-weight:bold; font-size: 15px;">${entryTitle}</div>
<div style="font-size: 13px; color:#666; line-height: 1.4;">${entryText}</div>

${i.affirmation ? `
    <div style="color: #4A90E2; font-size: 12px; font-style: italic; margin-top: 5px; border-left: 2px solid #B2CEFE; padding-left: 8px;">
        "${i.affirmation}"
    </div>` : ''}
                    ${i.reflection ? `
                        <div class="reflection-box">
                            <span style="font-weight:bold; color:#888; font-size:10px; text-transform:uppercase;">My Response:</span><br>
                            "${i.reflection}"
                        </div>` : ''}
                </div>
            </div>
        `;
    }).join('');
    
    showScreen('journal-screen');
    }
    function showToolbox() {
        const container = document.getElementById('bubbles-container');
        const display = document.getElementById('active-tool-text');
        
        // Set the welcoming "default" message
        display.innerHTML = "<span style='color:#666; font-style:italic;'>Tap a bubble to discover a secret for your nervous system...</span>";
        
        const uniqueTools = Array.from(new Set(inventory.filter(i => i.emoji !== 'üèÖ').map(i => i.emoji)))
            .map(emoji => inventory.find(i => i.emoji === emoji));
    
        if (uniqueTools.length === 0) {
            container.innerHTML = "<p>Complete a session to find your first tool!</p>";
        } else {
            container.innerHTML = uniqueTools.map(tool => `
                <div class="bubble" onclick="popBubble(this, '${tool.name}', '${tool.msg}')">
                    <span>${tool.emoji}</span>
                </div>
            `).join('');
        }
        showScreen('toolbox-screen');
    }

  function popBubble(el, name, msg) {
        // 1. Reset all bubbles to their full "soapy" state first
        document.querySelectorAll('.bubble').forEach(b => {
            b.classList.remove('popped');
        });
        
        // 2. Trigger the burst & jump on the clicked one
        el.classList.add('popped');
        
        // 3. Update the text with the deep Charcoal color for clarity
        const display = document.getElementById('active-tool-text');
        display.innerHTML = `
            <div style="color: #2D3748; font-weight: 800; font-size: 20px; margin-bottom: 5px;">${name}</div>
            <div style="color: #4A5568; font-weight: 500; line-height: 1.4; max-width: 320px; margin: 0 auto;">${msg}</div>
        `;
    }
    </script>
</body>
</html>
