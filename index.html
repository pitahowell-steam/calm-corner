<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kawaii Calm Sanctuary</title>
    <style>
        :root { --soft-pink: #FFB7B2; --soft-blue: #B2CEFE; --night-blue: #0A192F; --text-dark: #444; --glass: rgba(255, 255, 255, 0.96); }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html { margin: 0; padding: 0; height: 100%; font-family: -apple-system, sans-serif; overflow: hidden; background: #FDFCF0; color: var(--text-dark); }
        .bg-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; background-size: cover; background-position: center; transition: all 1.2s ease; }
        .star { position: absolute; background: white; border-radius: 50%; opacity: 0.8; animation: twinkle 2s infinite alternate; z-index: 2; }
        @keyframes twinkle { from { opacity: 0.2; } to { opacity: 1; } }
        .screen { display: none; height: 100vh; width: 100vw; flex-direction: column; align-items: center; justify-content: center; position: absolute; z-index: 10; padding: 20px; background: transparent; }
        .active { display: flex; }
        .glass-card { background: var(--glass); padding: 30px; border-radius: 35px; width: 100%; max-width: 420px; text-align: center; box-shadow: 0 15px 35px rgba(0,0,0,0.07); border: 1px solid rgba(255,255,255,0.3); }
        .scene-card { background: white; width: 90%; max-width: 360px; padding: 20px; border-radius: 25px; margin-bottom: 12px; border: 3px solid #F0F0F0; display: flex; align-items: center; cursor: pointer; transition: 0.2s; font-weight: bold; justify-content: center; }
        .pill-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin: 15px 0; }
        .pill { background: #F5F5F5; padding: 12px 20px; border-radius: 25px; font-weight: 600; color: #777; cursor: pointer; border: 2px solid transparent; }
        input, textarea { width: 100%; padding: 15px; border: 2px solid #EEE; border-radius: 18px; font-size: 16px; margin: 10px 0; outline: none; background: #FAFAFA; }
        .main-btn { color: white; padding: 16px 45px; border-radius: 35px; border: none; font-size: 18px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        #breath-screen { background: rgba(0,0,0,0) !important; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); z-index: 100; }
        #breath-text { color: white; position: relative; z-index: 200; margin-bottom: 70px; font-size: 34px; font-weight: bold; text-shadow: 0 4px 10px rgba(0,0,0,0.3); text-align: center; }
        #breath-wrap { position: relative; width: 320px; height: 320px; display: flex; align-items: center; justify-content: center; }
        #target-circle { position: absolute; width: 260px; height: 260px; border-radius: 50%; border: 5px dashed rgba(255,255,255,0.3); z-index: 50; }
        #breath-circle { width: 100px; height: 100px; border-radius: 50%; z-index: 60; transform: scale(1); will-change: transform; }
    </style>
</head>
<body>

    <div id="bg-layer" class="bg-layer"></div>

    <div id="login-screen" class="screen active">
        <div class="glass-card">
            <h1>‚ú® Kawaii Calm</h1>
            <p style="color: #888;">Welcome to your safe space.</p>
            <input type="text" id="name-input" placeholder="Enter Student Name..." autocomplete="off">
            <button class="main-btn" id="login-trigger" style="background: #B2CEFE;">Enter Sanctuary</button>
        </div>
    </div>

    <div id="home-screen" class="screen">
        <div class="glass-card">
            <h2 style="margin:0;">Hello, <span id="user-display"></span>!</h2>
            <p>üèÜ Points: <span id="points-display">0</span></p>
            <div class="scene-card" style="border-color: #FFB7B2;" onclick="setTheme('garden')">üå∏ Garden</div>
            <div class="scene-card" style="border-color: #B2CEFE;" onclick="setTheme('beach')">üèñÔ∏è Beach</div>
            <div class="scene-card" style="border-color: #4A90E2;" onclick="setTheme('night')">üåå Night</div>
            <button style="margin-top:15px; background:none; border:none; color:#AAA; cursor:pointer;" onclick="location.reload()">Switch User</button>
        </div>
    </div>

    <div id="before-screen" class="screen">
        <div class="glass-card">
            <h2>How do you feel?</h2>
            <div id="before-pills" class="pill-container"></div>
            <input type="text" id="before-custom" placeholder="Or type it here...">
            <button id="start-btn" class="main-btn" onclick="startBreath()">Start</button>
        </div>
    </div>

    <div id="breath-screen" class="screen">
        <h1 id="breath-text">Ready?</h1>
        <div id="breath-wrap">
            <div id="target-circle"></div>
            <div id="breath-circle"></div>
        </div>
    </div>

    <div id="after-screen" class="screen">
        <div class="glass-card">
            <h2>Breathe complete.</h2>
            <p>How do you feel now?</p>
            <div id="after-pills" class="pill-container"></div>
            <input type="text" id="after-custom" placeholder="I feel...">
            <button id="finish-btn" class="main-btn" onclick="handleLogic()">Get Reward</button>
        </div>
    </div>

    <div id="reward-screen" class="screen">
        <div class="glass-card" id="reward-content"></div>
    </div>

    <script>
        // --- DATA ---
        const SUGGESTED_BEFORE = ["Drained", "Tense", "Stressed", "Sad"];
        const SUGGESTED_AFTER = ["Steady", "Relaxed", "Better", "Calm"];
        const REWARDS = [
            { emoji: "üê¢", name: "Patience Turtle" },
            { emoji: "üê±", name: "Lucky Cat" },
            { emoji: "‚òÄÔ∏è", name: "Golden Sun" }
        ];

        let currentUser = "";
        let totalSessions = 0;
        let selectedTheme = { color: '#B2CEFE' };

        // --- CORE NAVIGATION ---
        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.style.display = 'none');
            document.getElementById(id).style.display = 'flex';
        }

        // --- LOGIN LOGIC ---
        const loginBtn = document.getElementById('login-trigger');
        const nameInput = document.getElementById('name-input');

        function performLogin() {
            const name = nameInput.value.trim();
            if(!name) {
                alert("Please enter a name!");
                return;
            }
            currentUser = name;
            document.getElementById('user-display').innerText = name;
            showScreen('home-screen');
        }

        loginBtn.onclick = performLogin;
        nameInput.onkeypress = (e) => { if(e.key === 'Enter') performLogin(); };

        // --- THEME & PILLS ---
        function setTheme(theme) {
            const bg = document.getElementById('bg-layer');
            bg.innerHTML = '';
            if(theme === 'garden') {
                selectedTheme.color = '#FFB7B2';
                bg.style.background = "#FDFCF0 url('https://images.unsplash.com/photo-1528459801416-a9e53bbf4e17?q=80&w=500') center/cover";
            } else if(theme === 'beach') {
                selectedTheme.color = '#B2CEFE';
                bg.style.background = "#E0F7FA url('https://images.unsplash.com/photo-1507525428034-b723cf961d3e?q=80&w=500') center/cover";
            } else {
                selectedTheme.color = '#4A90E2';
                bg.style.background = "#0A192F";
                for(let i=0; i<30; i++) {
                    let s = document.createElement('div'); s.className = 'star';
                    s.style.width = s.style.height = Math.random()*3+'px';
                    s.style.top = Math.random()*100+'%'; s.style.left = Math.random()*100+'%';
                    bg.appendChild(s);
                }
            }
            setupPills();
            showScreen('before-screen');
        }

        function setupPills() {
            document.getElementById('before-pills').innerHTML = SUGGESTED_BEFORE.map(m => `<div class="pill" onclick="selPill(this, 'before')">${m}</div>`).join('');
            document.getElementById('after-pills').innerHTML = SUGGESTED_AFTER.map(m => `<div class="pill" onclick="selPill(this, 'after')">${m}</div>`).join('');
            document.getElementById('start-btn').style.background = selectedTheme.color;
            document.getElementById('finish-btn').style.background = selectedTheme.color;
        }

        function selPill(el, type) {
            el.parentElement.querySelectorAll('.pill').forEach(p => p.style.borderColor = 'transparent');
            el.style.borderColor = selectedTheme.color;
            document.getElementById(type + '-custom').value = el.innerText;
        }

        // --- BREATHING ---
        function startBreath() {
            showScreen('breath-screen');
            const circle = document.getElementById('breath-circle');
            const txt = document.getElementById('breath-text');
            circle.style.backgroundColor = selectedTheme.color;
            
            const patterns = [
                {t: "Breathe In...", s: 2.6, d: 4000},
                {t: "Hold...", s: 2.6, d: 2000},
                {t: "Breathe Out...", s: 0.4, d: 6000},
                {t: "Rest...", s: 0.4, d: 2000}
            ];

            let step = 0;
            let cycle = 1;

            function next() {
                if (step >= patterns.length) {
                    if (cycle < 2) { cycle++; step = 0; } 
                    else { showScreen('after-screen'); return; }
                }
                txt.innerHTML = `${patterns[step].t}<br><small>Round ${cycle} of 2</small>`;
                circle.style.transition = `transform ${patterns[step].d}ms ease-in-out`;
                circle.style.transform = `scale(${patterns[step].s})`;
                setTimeout(() => { step++; next(); }, patterns[step].d);
            }
            next();
        }

        // --- REWARDS ---
        function handleLogic() {
            totalSessions++;
            document.getElementById('points-display').innerText = totalSessions;
            const r = REWARDS[Math.floor(Math.random()*REWARDS.length)];
            const content = document.getElementById('reward-content');
            content.innerHTML = `
                <div style="font-size:70px;">${r.emoji}</div>
                <h2>You found a ${r.name}!</h2>
                <button class="main-btn" style="background:#444;" onclick="showScreen('home-screen')">Back Home</button>
            `;
            showScreen('reward-screen');
        }
    </script>
</body>
</html>
