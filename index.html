

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kawaii Calm Sanctuary</title>
    <style>
       const SUGGESTED_BEFORE = ["Overwhelmed", "Frustrated", "Tense", "Stressed", "Sad"];
        const SUGGESTED_AFTER = ["Steady", "Relaxed", "Better", "Focused", "Stronger"];
        const MISSIONS = [
            { task: "Find 3 blue things in the room.", q: "What did you see?" },
            { task: "Press your feet into the floor.", q: "How does it feel? (Hard, soft?)" },
            { task: "Look for something shaped like a circle.", q: "What object did you find?" }
        ];
        const REWARDS = [
            { emoji: "üê¢", name: "Patience Turtle", msg: "Slow and steady is a superpower." },
            { emoji: "üê±", name: "Lucky Cat", msg: "A friend for your peaceful moments." },
            { emoji: "‚òÄÔ∏è", name: "Golden Sun", msg: "Your energy lights up the room." },
            { emoji: "‚òÅÔ∏è", name: "Happy Cloud", msg: "Bad feelings pass just like clouds." }
        ];

        let currentUser = "";
        let inventory = [];
        let totalSessions = 0;
        let selectedTheme = { color: '#B2CEFE' };

        // LOGIN ENGINE
        const loginBtn = document.getElementById('login-trigger');
        const nameInput = document.getElementById('name-input');

        function performLogin() {
            const name = nameInput.value.trim().toLowerCase();
            if(!name) return;
            currentUser = name;
            const saved = localStorage.getItem('@kawaii_' + currentUser);
            const data = saved ? JSON.parse(saved) : { inventory: [], total: 0 };
            inventory = data.inventory || [];
            totalSessions = data.total || 0;
            document.getElementById('user-display').innerText = currentUser;
            document.getElementById('points-display').innerText = totalSessions;
            showScreen('home-screen');
        }

        loginBtn.onclick = performLogin;
        nameInput.onkeypress = (e) => { if(e.key === 'Enter') performLogin(); };

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function setTheme(theme) {
            const bg = document.getElementById('bg-layer');
            bg.innerHTML = '';
            if(theme === 'garden') {
                selectedTheme.color = '#FFB7B2';
                bg.style.background = "url('https://images.unsplash.com/photo-1528459801416-a9e53bbf4e17?q=80&w=500') center/cover";
            } else if(theme === 'beach') {
                selectedTheme.color = '#B2CEFE';
                bg.style.background = "url('https://images.unsplash.com/photo-1507525428034-b723cf961d3e?q=80&w=500') center/cover";
            } else {
                selectedTheme.color = '#4A90E2';
                bg.style.background = "#0A192F";
                for(let i=0; i<35; i++) {
                    let s = document.createElement('div'); s.className = 'star';
                    s.style.width = s.style.height = Math.random()*3+'px';
                    s.style.top = Math.random()*100+'%'; s.style.left = Math.random()*100+'%';
                    bg.appendChild(s);
                }
            }
            setupPills();
            showScreen('before-screen');
        }

        function setupPills() {
            document.getElementById('before-pills').innerHTML = SUGGESTED_BEFORE.map(m => `<div class="pill" onclick="selPill(this, 'before')">${m}</div>`).join('');
            document.getElementById('after-pills').innerHTML = SUGGESTED_AFTER.map(m => `<div class="pill" onclick="selPill(this, 'after')">${m}</div>`).join('');
            document.getElementById('start-btn').style.background = selectedTheme.color;
            document.getElementById('finish-btn').style.background = selectedTheme.color;
        }

        function selPill(el, type) {
            el.parentElement.querySelectorAll('.pill').forEach(p => { p.style.background = '#F5F5F5'; p.style.borderColor = 'transparent'; });
            el.style.background = 'white'; el.style.borderColor = selectedTheme.color;
            document.getElementById(type + '-custom').value = el.innerText;
        }

        function startBreath() {
            showScreen('breath-screen');
            const circle = document.getElementById('breath-circle');
            const target = document.getElementById('target-circle');
            const txt = document.getElementById('breath-text');
            
            // Apply Theme Colors
            circle.style.backgroundColor = selectedTheme.color;
            target.style.borderColor = selectedTheme.color;
            target.style.opacity = "0.4";

            const patterns = [
                {t: "In...", s: 2.6, d: 4000}, 
                {t: "Hold", s: 2.6, d: 2000}, 
                {t: "Out...", s: 0.4, d: 6000}, 
                {t: "Rest", s: 0.4, d: 2000}
            ];
            let step = 0, cycle = 1;

            function next() {
                if (step >= patterns.length) {
                    if (cycle < 2) { cycle++; step = 0; } 
                    else { showScreen('after-screen'); return; }
                }
                txt.innerHTML = `${patterns[step].t}<br><small style="font-size:14px; opacity:0.6">Round ${cycle}/2</small>`;
                circle.style.transition = `transform ${patterns[step].d}ms ease-in-out`;
                circle.style.transform = `scale(${patterns[step].s})`;
                setTimeout(() => { step++; next(); }, patterns[step].d);
            }
            next();
        }

        function handleLogic() {
            const beforeMood = document.getElementById('before-custom').value || "Okay";
            const afterMood = document.getElementById('after-custom').value || "Better";
            const content = document.getElementById('reward-content');
            const isMission = Math.random() > 0.5;
            totalSessions++;

            if(isMission) {
                const m = MISSIONS[Math.floor(Math.random()*MISSIONS.length)];
                content.innerHTML = `
                    <p style="color:#4CAF50; font-weight:bold;">üßò GROUNDING MISSION</p>
                    <h2>${m.task}</h2><p>${m.q}</p>
                    <textarea id="mission-refl" placeholder="Type what you found..."></textarea>
                    <button class="main-btn" style="background:#4CAF50" onclick="saveMission('${m.task}', '${beforeMood}', '${afterMood}')">Save Mission</button>
                `;
            } else {
                const r = REWARDS[Math.floor(Math.random()*REWARDS.length)];
                inventory.unshift({ emoji: r.emoji, name: r.name, msg: r.msg, before: beforeMood, after: afterMood, date: new Date().toLocaleDateString() });
                content.innerHTML = `
                    <div style="font-size:80px;">${r.emoji}</div>
                    <h2>${r.name}</h2><p>"${r.msg}"</p>
                    <button class="main-btn" style="background:${selectedTheme.color}" onclick="showScreen('home-screen')">Collect Reward</button>
                `;
            }
            saveData();
            showScreen('reward-screen');
        }

        function saveMission(task, before, after) {
            const refl = document.getElementById('mission-refl').value || "Completed";
            inventory.unshift({ emoji: 'üèÖ', name: 'Mission Medal', msg: task, reflection: refl, before: before, after: after, date: new Date().toLocaleDateString() });
            saveData();
            showScreen('home-screen');
        }

        function saveData() {
            localStorage.setItem('@kawaii_' + currentUser, JSON.stringify({inventory, total: totalSessions}));
            const pointsDisp = document.getElementById('points-display');
            if(pointsDisp) pointsDisp.innerText = totalSessions;
        }

        function showJournal() {
            const list = document.getElementById('journal-list');
            list.innerHTML = inventory.length === 0 ? "<p>No entries yet!</p>" : inventory.map(i => `
                <div class="journal-card">
                    <div style="font-size:35px;">${i.emoji}</div>
                    <div style="flex:1">
                        <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                            <span class="mood-tag">${i.date}</span>
                            <span style="font-size:11px; color:${selectedTheme.color}; font-weight:bold;">${i.before} ‚ûî ${i.after}</span>
                        </div>
                        <div style="font-weight:bold;">${i.name}</div>
                        <div style="font-size:13px; color:#666;">${i.msg}</div>
                        ${i.reflection ? `<div class="reflection-box">" ${i.reflection} "</div>` : ''}
                    </div>
                </div>
            `).join('');
            showScreen('journal-screen');
        }
    </style>
</head>
<body>

    <div id="bg-layer" class="bg-layer"></div>

    <div id="login-screen" class="screen active">
        <div class="glass-card">
            <h1>‚ú® Kawaii Calm</h1>
            <p style="color: #888;">Welcome to your safe space.</p>
            <input type="text" id="name-input" placeholder="Enter Name..." autocomplete="off">
            <button class="main-btn" id="login-trigger" style="background: var(--soft-blue);">Enter Sanctuary</button>
        </div>
    </div>

    <div id="home-screen" class="screen">
        <div class="glass-card">
            <h2 style="margin:0;">Hi, <span id="user-display"></span>!</h2>
            <p style="font-weight: bold; color: #888;">üèÜ Points: <span id="points-display">0</span></p>
            <div class="scene-card" style="border-color: var(--soft-pink);" onclick="setTheme('garden')">üå∏ Garden</div>
            <div class="scene-card" style="border-color: var(--soft-blue);" onclick="setTheme('beach')">üèñÔ∏è Beach</div>
            <div class="scene-card" style="border-color: #4A90E2;" onclick="setTheme('night')">üåå Night</div>
            <button style="margin-top:15px; background:none; border:none; color: #4A90E2; font-weight:bold; cursor:pointer;" onclick="showJournal()">üìñ View Journey</button>
            <br>
            <button style="margin-top:10px; background:none; border:none; color:#CCC; cursor:pointer; font-size:12px;" onclick="location.reload()">Switch User</button>
        </div>
    </div>

    <div id="before-screen" class="screen">
        <div class="glass-card">
            <h2>How do you feel?</h2>
            <div id="before-pills" class="pill-container"></div>
            <input type="text" id="before-custom" placeholder="Or describe it here...">
            <button id="start-btn" class="main-btn" onclick="startBreath()">Start Breathing</button>
        </div>
    </div>

    <div id="breath-screen" class="screen">
        <h1 id="breath-text">Ready?</h1>
        <div id="breath-container" style="position: relative; flex: 1; display: flex; align-items: center; justify-content: center; width: 100%;">
            <div id="target-circle"></div>
            <div id="breath-circle"></div>
        </div>
    </div>

    <div id="after-screen" class="screen">
        <div class="glass-card">
            <h2>Feeling better?</h2>
            <div id="after-pills" class="pill-container"></div>
            <input type="text" id="after-custom" placeholder="I feel...">
            <button id="finish-btn" class="main-btn" onclick="handleLogic()">Complete Session</button>
        </div>
    </div>

    <div id="reward-screen" class="screen">
        <div class="glass-card" id="reward-content"></div>
    </div>

    <div id="journal-screen" class="screen" style="background: #F9FAFB;">
        <h2 style="margin-bottom: 5px;">Your Journey Journal</h2>
        <div id="journal-list" class="journal-list"></div>
        <button class="main-btn" style="background: #444; width: 200px; margin: 20px;" onclick="showScreen('home-screen')">Back Home</button>
    </div>

    <script>
        const SUGGESTED_BEFORE = ["Overwhelmed", "Frustrated", "Tense", "Stressed", "Sad"];
        const SUGGESTED_AFTER = ["Steady", "Relaxed", "Better", "Focused", "Stronger"];
        const MISSIONS = [
            { task: "Find 3 blue things in the room.", q: "What did you see?" },
            { task: "Press your feet into the floor.", q: "How does it feel? (Hard, soft?)" },
            { task: "Look for something shaped like a circle.", q: "What object did you find?" }
        ];
        const REWARDS = [
            { emoji: "üê¢", name: "Patience Turtle", msg: "Slow and steady is a superpower." },
            { emoji: "üê±", name: "Lucky Cat", msg: "A friend for your peaceful moments." },
            { emoji: "‚òÄÔ∏è", name: "Golden Sun", msg: "Your energy lights up the room." },
            { emoji: "‚òÅÔ∏è", name: "Happy Cloud", msg: "Bad feelings pass just like clouds." }
        ];

        let currentUser = "";
        let inventory = [];
        let totalSessions = 0;
        let selectedTheme = { color: '#B2CEFE' };

        // LOGIN ENGINE
        const loginBtn = document.getElementById('login-trigger');
        const nameInput = document.getElementById('name-input');

        function performLogin() {
            const name = nameInput.value.trim().toLowerCase();
            if(!name) return;
            currentUser = name;
            const saved = localStorage.getItem('@kawaii_' + currentUser);
            const data = saved ? JSON.parse(saved) : { inventory: [], total: 0 };
            inventory = data.inventory || [];
            totalSessions = data.total || 0;
            document.getElementById('user-display').innerText = currentUser;
            document.getElementById('points-display').innerText = totalSessions;
            showScreen('home-screen');
        }

        loginBtn.onclick = performLogin;
        nameInput.onkeypress = (e) => { if(e.key === 'Enter') performLogin(); };

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function setTheme(theme) {
            const bg = document.getElementById('bg-layer');
            bg.innerHTML = '';
            if(theme === 'garden') {
                selectedTheme.color = '#FFB7B2';
                bg.style.background = "url('https://images.unsplash.com/photo-1528459801416-a9e53bbf4e17?q=80&w=500') center/cover";
            } else if(theme === 'beach') {
                selectedTheme.color = '#B2CEFE';
                bg.style.background = "url('https://images.unsplash.com/photo-1507525428034-b723cf961d3e?q=80&w=500') center/cover";
            } else {
                selectedTheme.color = '#4A90E2';
                bg.style.background = "#0A192F";
                for(let i=0; i<35; i++) {
                    let s = document.createElement('div'); s.className = 'star';
                    s.style.width = s.style.height = Math.random()*3+'px';
                    s.style.top = Math.random()*100+'%'; s.style.left = Math.random()*100+'%';
                    bg.appendChild(s);
                }
            }
            setupPills();
            showScreen('before-screen');
        }

        function setupPills() {
            document.getElementById('before-pills').innerHTML = SUGGESTED_BEFORE.map(m => `<div class="pill" onclick="selPill(this, 'before')">${m}</div>`).join('');
            document.getElementById('after-pills').innerHTML = SUGGESTED_AFTER.map(m => `<div class="pill" onclick="selPill(this, 'after')">${m}</div>`).join('');
            document.getElementById('start-btn').style.background = selectedTheme.color;
            document.getElementById('finish-btn').style.background = selectedTheme.color;
        }

        function selPill(el, type) {
            el.parentElement.querySelectorAll('.pill').forEach(p => { p.style.background = '#F5F5F5'; p.style.borderColor = 'transparent'; });
            el.style.background = 'white'; el.style.borderColor = selectedTheme.color;
            document.getElementById(type + '-custom').value = el.innerText;
        }

        function startBreath() {
            showScreen('breath-screen');
            const circle = document.getElementById('breath-circle');
            const target = document.getElementById('target-circle'); // Add this line
            const txt = document.getElementById('breath-text');
            
            circle.style.backgroundColor = selectedTheme.color;
            target.style.borderColor = selectedTheme.color; // This makes the target match!
            target.style.opacity = "0.4"; // Makes the target soft and calm
            showScreen('breath-screen');
            const circle = document.getElementById('breath-circle');
            const txt = document.getElementById('breath-text');
            circle.style.backgroundColor = selectedTheme.color;
            const patterns = [{t: "In...", s: 2.6, d: 4000}, {t: "Hold", s: 2.6, d: 2000}, {t: "Out...", s: 0.4, d: 6000}, {t: "Rest", s: 0.4, d: 2000}];
            let step = 0, cycle = 1;

            function next() {
                if (step >= patterns.length) {
                    if (cycle < 2) { cycle++; step = 0; } 
                    else { showScreen('after-screen'); return; }
                }
                txt.innerHTML = `${patterns[step].t}<br><small style="font-size:14px; opacity:0.6">Round ${cycle}/2</small>`;
                circle.style.transition = `transform ${patterns[step].d}ms ease-in-out`;
                circle.style.transform = `scale(${patterns[step].s})`;
                setTimeout(() => { step++; next(); }, patterns[step].d);
            }
            next();
        }

        function handleLogic() {
            const beforeMood = document.getElementById('before-custom').value || "Okay";
            const afterMood = document.getElementById('after-custom').value || "Better";
            const content = document.getElementById('reward-content');
            
            const isMission = Math.random() > 0.5;
            totalSessions++;

            if(isMission) {
                const m = MISSIONS[Math.floor(Math.random()*MISSIONS.length)];
                content.innerHTML = `
                    <p style="color:#4CAF50; font-weight:bold;">üßò GROUNDING MISSION</p>
                    <h2>${m.task}</h2><p>${m.q}</p>
                    <textarea id="mission-refl" placeholder="Type what you found..."></textarea>
                    <button class="main-btn" style="background:#4CAF50" onclick="saveMission('${m.task}', '${beforeMood}', '${afterMood}')">Save Mission</button>
                `;
            } else {
                const r = REWARDS[Math.floor(Math.random()*REWARDS.length)];
                inventory.unshift({ emoji: r.emoji, name: r.name, msg: r.msg, before: beforeMood, after: afterMood, date: new Date().toLocaleDateString() });
                content.innerHTML = `
                    <div style="font-size:80px;">${r.emoji}</div>
                    <h2>${r.name}</h2><p>"${r.msg}"</p>
                    <button class="main-btn" style="background:${selectedTheme.color}" onclick="showScreen('home-screen')">Collect Reward</button>
                `;
            }
            saveData();
            showScreen('reward-screen');
        }

        function saveMission(task, before, after) {
            const refl = document.getElementById('mission-refl').value || "Completed";
            inventory.unshift({ emoji: 'üèÖ', name: 'Mission Medal', msg: task, reflection: refl, before: before, after: after, date: new Date().toLocaleDateString() });
            saveData();
            showScreen('home-screen');
        }

        function saveData() {
            localStorage.setItem('@kawaii_' + currentUser, JSON.stringify({inventory, total: totalSessions}));
            document.getElementById('points-display').innerText = totalSessions;
        }

        function showJournal() {
            const list = document.getElementById('journal-list');
            list.innerHTML = inventory.length === 0 ? "<p>No entries yet!</p>" : inventory.map(i => `
                <div class="journal-card">
                    <div style="font-size:35px;">${i.emoji}</div>
                    <div style="flex:1">
                        <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                            <span class="mood-tag">${i.date}</span>
                            <span style="font-size:11px; color:${selectedTheme.color}; font-weight:bold;">${i.before} ‚ûî ${i.after}</span>
                        </div>
                        <div style="font-weight:bold;">${i.name}</div>
                        <div style="font-size:13px; color:#666;">${i.msg}</div>
                        ${i.reflection ? `<div class="reflection-box">" ${i.reflection} "</div>` : ''}
                    </div>
                </div>
            `).join('');
            showScreen('journal-screen');
        }
    </script>
</body>
</html>
